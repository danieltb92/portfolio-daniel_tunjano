---
import LinkedinIcon from "@/assets/socials/RiLinkedinBoxLine.svg";
import GithubIcon from "@/assets/socials/RiGithubFill.svg";
import WhatsappIcon from "@/assets/socials/RiWhatsappLine.svg";
import EmailIcon from "@/assets/socials/RiMailLine.svg";
import { profile } from "@/data/data.json";
import AvailableBagde from "@/components/ui/Bagde.astro";
import { useTranslations } from "@/i18n/utils";
import { languageList } from "@/i18n/ui";
import Background from "@/components/ui/Background.astro";
import BackgroundAura from "@/components/ui/BackgraoundAura.astro";
import type { ImageMetadata } from "astro";

// i18n Obtener el idioma actual y la función de traducción
const currentLang = Astro.currentLocale || "es";
const translateLabels = useTranslations(
  currentLang as keyof typeof languageList
);

const profileWords = translateLabels("hero.profileWords");
const roles = profileWords;
---

<section
  id="hero"
  class="relative z-20 md:max-w-5xl mx-auto h-[100dvh] flex flex-col items-center justify-center px-4 pt-16 overflow-visible"
>
  <div
    id="hero-background"
    class="absolute inset-0 -z-10 [mask-image:linear-gradient(to_top,transparent,black_70%)]"
  >
    <!-- md:right-[calc(10%-60vw)] -->
  </div>
  <!-- <Background /> -->
  <!-- <BackgroundAura /> -->

  <AvailableBagde
    text={translateLabels("hero.textStatus")}
    status="available"
  />
  <h1 class="text-[19vw] lg:text-[14vw] font-bold text-center leading-none">
    <span
      id="changing-word"
      class="block text-[10vw] lg:text-[8vw] opacity-50 transition-all duration-500 ease-in-out"
    >
      {roles[0]}
    </span>
    <span
      class="block leading-none bg-clip-text bg-gradient-to-r text-[var(--color-text)]"
    >
      <!-- text-transparent from-blue-600 to-[var(--color-accent)] -->
      {translateLabels("hero.title")}
    </span>
  </h1>

  <p class="text-center text-gray-600 dark:text-gray-400 text-lg">
    {translateLabels("hero.subtitle")}
  </p>
  <ul class="flex flex-row gap-6 mt-6 text-gray-400">
    <li>
      <a
        href={profile.social.linkedin}
        class="hover:text-[var(--color-primary)]"
        target="_blank"
        rel="noopener noreferrer"><LinkedinIcon /></a
      >
    </li>
    <li>
      <a
        href={profile.social.github}
        class="hover:text-[var(--color-primary)]"
        target="_blank"
        rel="noopener noreferrer"><GithubIcon /></a
      >
    </li>
    <li>
      <a
        href={`https://wa.me/${profile.phone}`}
        class="hover:text-[var(--color-primary)]"
        target="_blank"
        rel="noopener noreferrer"><WhatsappIcon /></a
      >
    </li>
    <li>
      <a
        href={`mailto:${profile.email}`}
        class="hover:text-[var(--color-primary)]"><EmailIcon /></a
      >
    </li>
  </ul>

  <script define:vars={{ profileWords }}>
    const roles = profileWords;
    let current = 0;
    const textElement = document.getElementById("changing-word");

    if (textElement) {
      setInterval(() => {
        textElement.classList.add("opacity-0", "translate-y-2");
        setTimeout(() => {
          current = (current + 1) % roles.length;
          textElement.textContent = roles[current];
          textElement.classList.remove("opacity-0", "translate-y-2");
        }, 400);
      }, 2500);
    }
  </script>

  <script
    is:inline
    src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.1/p5.min.js"></script>
  <script
    is:inline
    src="https://cdnjs.cloudflare.com/ajax/libs/vanta/0.5.24/vanta.trunk.min.js"
  ></script>
  <script is:inline>
    let vantaEffect = null;

    const getThemeColor = () => {
      const isDark =
        document.documentElement.getAttribute("data-theme") === "dark" ||
        document.documentElement.classList.contains("dark");
      // Color Light: #eff9ff (0xeff9ff), Color Dark: #000000 (0x000000)
      return isDark ? 0x000000 : 0xeff9ff;
    };

    const initVanta = () => {
      if (!vantaEffect) {
        vantaEffect = VANTA.TRUNK({
          el: "#hero-background",
          mouseControls: true,
          touchControls: true,
          gyroControls: false,
          minHeight: 200.0,
          minWidth: 200.0,
          scale: 1.0,
          scaleMobile: 1.0,
          color: 0x1088e8,
          backgroundColor: getThemeColor(),
          spacing: 1.0,
          chaos: 4.0,
        });
      }
    };

    const stopVanta = () => {
      if (vantaEffect) {
        vantaEffect.destroy();
        vantaEffect = null;
      }
    };

    // Iniciar efecto
    initVanta();

    // Observar cambios de tema
    const observer = new MutationObserver(() => {
      stopVanta();
      initVanta();
    });

    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ["data-theme", "class"],
    });

    // Limpieza al desmontar (astro:before-swap es para transiciones de vista, pero útil tener en cuenta)
    document.addEventListener("astro:before-swap", stopVanta);
  </script>
</section>
