---
import LinkedinIcon from "@/assets/socials/RiLinkedinBoxLine.svg";
import GithubIcon from "@/assets/socials/RiGithubFill.svg";
import WhatsappIcon from "@/assets/socials/RiWhatsappLine.svg";
import EmailIcon from "@/assets/socials/RiMailLine.svg";
import { profile } from "@/data/data.json";
import AvailableBagde from "@/components/ui/Bagde.astro";
import { useTranslations } from "@/i18n/utils";
import { languageList } from "@/i18n/ui";
import Background from "@/components/ui/Background.astro";
import BackgroundAura from "@/components/ui/BackgraoundAura.astro";
import VantaBackground from "@/components/effects/VantaBackground.astro";
import type { ImageMetadata } from "astro";
import Button from "@/components/ui/Button.astro";

// i18n Obtener el idioma actual y la función de traducción
const currentLang = Astro.currentLocale || "es";
const translateLabels = useTranslations(
  currentLang as keyof typeof languageList,
);

const profileWords = translateLabels("hero.profileWords");
const roles = profileWords;
---

<section
  id="hero"
  class="relative z-20 md:max-w-5xl mx-auto h-[100dvh] flex flex-col items-center justify-center px-4 pt-16 overflow-visible"
>
  <!-- <VantaBackground /> -->
  <!-- <Background /> -->
  <!-- <BackgroundAura /> -->

  <AvailableBagde
    text={translateLabels("hero.textStatus")}
    status="available"
  />
  <h1 class="text-[19vw] lg:text-[14vw] font-bold text-center leading-none">
    <span
      id="changing-word"
      class="block text-[10vw] lg:text-[8vw] opacity-50 transition-all duration-500 ease-in-out"
    >
      {roles[0]}
    </span>
    <span
      class="block leading-none bg-clip-text bg-gradient-to-r text-[var(--color-text)]"
    >
      <!-- text-transparent from-blue-600 to-[var(--color-accent)] -->
      {translateLabels("hero.title")}
    </span>
  </h1>

  <p class="text-center text-gray-600 dark:text-gray-400 text-lg">
    {translateLabels("hero.subtitle")}
  </p>
  <!-- Social Icons -->
  <div class="flex flex-row gap-6 mt-6">
    <Button
      variant="primary"
      size="lg"
      href={profile.social.linkedin}
      target="_blank"
      rel="noopener noreferrer"
    >
      <LinkedinIcon />
      LinkedIn
    </Button>
    <Button
      variant="outline"
      size="lg"
      href={profile.social.github}
      target="_blank"
      rel="noopener noreferrer"
    >
      <GithubIcon />
      Github
    </Button>
  </div>
  <!-- <ul class="flex flex-row gap-6 mt-6 text-gray-400">
    <li>
      <a
        href={profile.social.linkedin}
        class="hover:text-[var(--color-primary)]"
        target="_blank"
        rel="noopener noreferrer"><LinkedinIcon /></a
      >
    </li>
    <li>
      <a
        href={profile.social.github}
        class="hover:text-[var(--color-primary)]"
        target="_blank"
        rel="noopener noreferrer"><GithubIcon /></a
      >
    </li>
    <li>
      <a
        href={`https://wa.me/${profile.phone}`}
        class="hover:text-[var(--color-primary)]"
        target="_blank"
        rel="noopener noreferrer"><WhatsappIcon /></a
      >
    </li>
    <li>
      <a
        href={`mailto:${profile.email}`}
        class="hover:text-[var(--color-primary)]"><EmailIcon /></a
      >
    </li>
  </ul> -->

  <!-- ========================================== -->
  <!--      SECCIÓN: ANIMACIÓN DE TEXTO (HERO)    -->
  <!-- ========================================== -->
  <script define:vars={{ profileWords }}>
    // Array de palabras (roles) que se mostrarán de forma rotativa, provenientes de i18n
    const roles = profileWords;
    let current = 0; // Índice actual de la palabra mostrada
    const textElement = document.getElementById("changing-word");

    if (textElement) {
      // Establecer un intervalo para cambiar el texto cada 2500ms (2.5s)
      setInterval(() => {
        // Paso 1: Iniciar la animación de salida (fade-out)
        // Se añade opacidad 0 y desplazamiento vertical para ocultar el texto actual
        textElement.classList.add("opacity-0", "translate-y-2");

        // Paso 2: Cambiar el texto una vez que la transición de salida ha avanzado
        // Esperamos 400ms que coincide con la duración de la transición CSS (duration-500 aprox)
        setTimeout(() => {
          // Calcular el siguiente índice (ciclo infinito usando módulo)
          current = (current + 1) % roles.length;

          // Actualizar el contenido de texto en el DOM
          textElement.textContent = roles[current];

          // Paso 3: Iniciar la animación de entrada (fade-in)
          // Se remueven las clases que ocultaban el texto
          textElement.classList.remove("opacity-0", "translate-y-2");
        }, 400);
      }, 2500);
    }
  </script>
  <!-- ========================================== -->
  <!--    FIN SECCIÓN: ANIMACIÓN DE TEXTO (HERO)  -->
  <!-- ========================================== -->
</section>

<script>
  import { gsap } from "gsap";

  const initHeroAnimation = () => {
    const heroTitle = document.querySelector("#hero h1");
    if (!heroTitle) return;

    const tl = gsap.timeline();

    tl.from("#hero h1", {
      y: 50,
      opacity: 0,
      duration: 2,
      ease: "power3.out",
    })
      .from(
        "#hero p",
        {
          y: 30,
          opacity: 0,
          duration: 0.8,
          ease: "power3.out",
        },
        "-=0.6",
      )
      .from(
        "#hero ul li",
        {
          y: 20,
          opacity: 0,
          stagger: 0.1,
          duration: 0.6,
          ease: "power3.out",
        },
        "-=0.4",
      );
  };

  initHeroAnimation();
  document.addEventListener("astro:after-swap", initHeroAnimation);
</script>
