---
import { getRelativeLocaleUrl } from "astro:i18n";
import MenuIcon from "@/assets/icons/AntDesignMenuOutlined.svg";
import Logo from "@/assets/logo.svg";
import { useTranslations } from "@/i18n/utils";
import { languageList } from "@/i18n/ui";
import ThemeToggle from "@/components/ui/ThemeToggle.astro";
import LanguageToggle from "@/components/ui/LanguageToggle.astro";

// i18n Obtener el idioma actual y la función de traducción
const currentLang = Astro.currentLocale || "es";
const translateLabels = useTranslations(
  currentLang as keyof typeof languageList,
);
---

<header class="fixed top-0 left-0 w-full z-50 px-2">
  <nav
    class="max-w-lg md:max-w-4xl mx-auto mt-2 mb-10 flex justify-center items-center flex-col lg:flex-row"
  >
    <div
      class="w-full md:max-w-lg flex items-center justify-between lg:justify-center h-13 gap-18 px-6 bg-[var(--color-bg)]/50 backdrop-blur-md rounded-4xl shadow-md dark:shadow-white/10"
    >
      <!-- Logo o Nombre -->
      <a href={getRelativeLocaleUrl(currentLang, "/")}><Logo class="w-10" /></a>

      <!-- Menú Desktop -->
      <ul class="hidden lg:flex items-center gap-8">
        <li>
          <a
            href={getRelativeLocaleUrl(currentLang, "about")}
            class="text-md hover:border-b transition-colors"
            >{translateLabels("nav.about")}</a
          >
        </li>
        <li>
          <a
            href={`${getRelativeLocaleUrl(currentLang, "")}#projects`}
            class="text-md hover:border-b transition-colors"
            >{translateLabels("nav.projects")}</a
          >
        </li>
        <li>
          <a href="#contact" class="text-md hover:border-b transition-colors"
            >{translateLabels("nav.contact")}</a
          >
        </li>
      </ul>

      <!-- Botón Menú Móvil -->
      <button
        id="menu-toggle"
        class="lg:hidden p-2 rounded-lg hover:bg-[var(--color-text)]/10 transition-colors"
        aria-label="Toggle menu"
      >
        <!-- Icono Menú (hamburguesa) -->
        <span id="menu-icon-open" class="block">
          <MenuIcon class="w-6 h-6" />
        </span>
        <!-- Icono Cerrar (X) -->
        <span id="menu-icon-close" class="hidden">
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </span>
      </button>
    </div>
    <!-- Botones de acción -->
    <div
      class="flex items-center gap-2 absolute right-8 h-13 px-4 bg-[var(--color-bg)]/50 backdrop-blur-md rounded-4xl shadow-md max-md:hidden"
    >
      <LanguageToggle />
      <ThemeToggle />
    </div>

    <!-- Menú Móvil -->
    <div
      id="mobile-menu"
      class="hidden lg:hidden relative top-0 m-0 w-full h-screen bg-[var(--color-bg)]/80 backdrop-blur-md shadow-lg z-40 rounded-4xl"
    >
      <ul class="flex flex-col py-4">
        <li>
          <a
            href="/about"
            class="block content-center pl-8 px-2 py-2 text-2xl h-20 border-b-1 border-[var(--color-text)] hover:border-b-[var(--color-primary)] transition-colors"
          >
            {translateLabels("nav.about")}
          </a>
        </li>
        <li>
          <a
            href={`${getRelativeLocaleUrl(currentLang, "")}#projects`}
            class="block content-center pl-8 px-2 py-2 text-2xl h-20 border-b-1 border-[var(--color-text)] hover:border-b-[var(--color-primary)] transition-colors"
          >
            {translateLabels("nav.projects")}
          </a>
        </li>
        <li>
          <a
            href="#contact"
            class="block content-center pl-8 px-2 py-2 text-2xl h-20 border-b-1 border-[var(--color-text)] hover:border-b-[var(--color-primary)] transition-colors"
          >
            {translateLabels("nav.contact")}
          </a>
        </li>
      </ul>
      <div class="flex justify-end items-center gap-2 h-13 px-4">
        <LanguageToggle />
        <ThemeToggle />
      </div>
    </div>
  </nav>
</header>

<script>
  // Manejo del menú móvil
  const menuToggle = document.getElementById("menu-toggle");
  const mobileMenu = document.getElementById("mobile-menu");
  const menuIconOpen = document.getElementById("menu-icon-open");
  const menuIconClose = document.getElementById("menu-icon-close");
  let isMenuOpen = false;

  if (menuToggle && mobileMenu && menuIconOpen && menuIconClose) {
    menuToggle.addEventListener("click", () => {
      isMenuOpen = !isMenuOpen;
      mobileMenu.classList.toggle("hidden");

      // Alternar entre iconos de menú y cerrar
      if (isMenuOpen) {
        menuIconOpen.classList.add("hidden");
        menuIconClose.classList.remove("hidden");
      } else {
        menuIconOpen.classList.remove("hidden");
        menuIconClose.classList.add("hidden");
      }
    });

    // Cerrar menú al hacer click en un enlace
    const menuLinks = mobileMenu.querySelectorAll("a");
    menuLinks.forEach((link) => {
      link.addEventListener("click", () => {
        mobileMenu.classList.add("hidden");
        isMenuOpen = false;
        menuIconOpen.classList.remove("hidden");
        menuIconClose.classList.add("hidden");
      });
    });
  }

  // Ocultar/mostrar header al hacer scroll
  let lastScroll = 0;
  const header = document.querySelector("header");

  window.addEventListener("scroll", () => {
    if (!header) return;

    const currentScroll = window.pageYOffset;

    if (currentScroll <= 0) {
      header.classList.remove("-translate-y-full");
      return;
    }

    if (currentScroll > lastScroll && !isMenuOpen) {
      header.classList.add("-translate-y-full");
    } else {
      header.classList.remove("-translate-y-full");
    }

    lastScroll = currentScroll;
  });
</script>

<style>
  header {
    transition: transform 0.3s ease;
  }

  .mobile-menu-enter {
    opacity: 0;
    transform: scale(0.95);
  }

  .mobile-menu-enter-active {
    opacity: 1;
    transform: scale(1);
    transition:
      opacity 0.3s ease,
      transform 0.3s ease;
  }

  .mobile-menu-exit {
    opacity: 1;
    transform: scale(1);
  }

  .mobile-menu-exit-active {
    opacity: 0;
    transform: scale(0.95);
    transition:
      opacity 0.3s ease,
      transform 0.3s ease;
  }
</style>
